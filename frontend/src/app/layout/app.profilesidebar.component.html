<p-sidebar [(visible)]="visible" position="right" [transitionOptions]="'.3s cubic-bezier(0, 0, 0.2, 1)'"
    styleClass="layout-profile-sidebar w-full sm:w-28rem">

    <div class="layout-rightmenu h-full overflow-y-auto overflow-x-hidden"
        [ngClass]="{'layout-rightmenu-active': layoutService.state.rightMenuActive}">

        <div class="user-detail-wrapper text-center" style=" padding: 4.5rem 0 2rem 0;" *ngIf="user">
            <div class="user-detail-content mb-4">
                <!-- Placeholder image or user profile pic -->
                <p-avatar [label]="user.name.charAt(0)" size="xlarge" shape="circle" [style]="{'background-color': '#2196F3', 'color': '#ffffff', 'width': '100px', 'height': '100px', 'font-size': '40px'}"></p-avatar>
                
                <span class="user-name text-2xl text-center block mt-4 mb-1">{{ user.name }}</span>
                <span class="user-number text-600">{{ user.email }}</span>
                <div class="mt-2">
                    <p-tag [value]="user.role | uppercase" [severity]="isAdminOrManager() ? 'warning' : 'info'"></p-tag>
                </div>
            </div>
            
            <!-- KPIs resumidos -->
            <div class="user-tasks flex justify-content-around align-items-center py-4 px-3 border-bottom-1 surface-border" *ngIf="stats">
                <div class="user-tasks-item in-progress font-medium" *ngIf="isAdminOrManager()">
                    <a class="task-number text-blue-500 flex justify-content-center align-items-center border-round mx-auto"
                        style="background:rgba(33, 150, 243, 0.1); padding: 9px; width: 50px; height: 50px; font-size: 24px;">
                        {{ stats.totalUsers || 0 }}
                    </a>
                    <span class="task-name block mt-3">Usuarios</span>
                </div>
                
                <div class="user-tasks-item font-medium">
                    <a class="task-number text-green-500 flex justify-content-center align-items-center border-round mx-auto" 
                       style="background:rgba(11, 209, 138, 0.1); padding: 9px; width: 50px; height: 50px; font-size: 24px;">
                        {{ isAdminOrManager() ? (stats.todayBookingsCount || 0) : (stats.myActiveBookingsCount || 0) }}
                    </a>
                    <span class="task-name block mt-3">{{ isAdminOrManager() ? 'Reservas Hoy' : 'Mis Reservas' }}</span>
                </div>
            </div>
        </div>

        <div>
            <p-calendar [(ngModel)]="date" [inline]="true" styleClass="w-full p-0"></p-calendar>
        </div>

        <div class="daily-plan-wrapper mt-5">
            <span class="today-date capitalize">{{ todayDateString }}</span>
            
            <div *ngIf="loading" class="flex justify-content-center mt-4">
                <i class="pi pi-spin pi-spinner text-2xl"></i>
            </div>

            <ul class="list-none overflow-hidden p-0 m-0" *ngIf="!loading">
                <li *ngFor="let event of events" class="mt-3 border-round py-2 px-3 flex flex-column" 
                    style="background:rgba(255, 255, 255, 0.05); border-left: 4px solid;"
                    [style.border-left-color]="event.color">
                    <span class="event-time block font-semibold text-color-secondary">{{ event.time }}</span>
                    <span class="event-topic block mt-2">{{ event.topic }}</span>
                </li>
                
                <li *ngIf="events.length === 0" class="mt-3 text-center text-color-secondary">
                    No hay eventos para mostrar.
                </li>
            </ul>
        </div>
    </div>

</p-sidebar>
